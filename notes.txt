Private Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel As Boolean)
    Dim pptApp As Object
    Dim pptPres As Object
    Dim fullPath As String
    Dim fileName As String
    Dim slideNum As Integer
    Dim parentFolder As String

    ' 1. Check the range
    If Not Intersect(Target, Range("D6:D13")) Is Nothing Then
        Cancel = True 

        ' 2. Handle the Folder Path
        ' This checks if the workbook has been saved and gets the parent folder
        If InStr(ThisWorkbook.Path, "\") > 0 Then
            parentFolder = Left(ThisWorkbook.Path, InStrRev(ThisWorkbook.Path, "\") - 1)
        Else
            MsgBox "Please save your Excel file first!", vbCritical
            Exit Sub
        End If
        
        fileName = "Charter Dev Form_v1.ppsx"
        fullPath = parentFolder & "\" & fileName
        
        ' 3. Get slide number from Column E
        slideNum = Val(Target.Offset(0, 1).Value)
        If slideNum = 0 Then slideNum = 1

        On Error Resume Next
        ' 4. Connect to PowerPoint
        Set pptApp = GetObject(Class:="PowerPoint.Application")
        If pptApp Is Nothing Then
            Set pptApp = CreateObject(Class:="PowerPoint.Application")
            pptApp.Visible = True
        End If
        
        ' 5. Open the presentation if not already open
        Set pptPres = pptApp.Presentations(fileName)
        If pptPres Is Nothing Then
            ' Check if file actually exists at the path
            If Dir(fullPath) = "" Then
                MsgBox "File NOT found at:" & vbCrLf & fullPath, vbCritical
                Exit Sub
            End If
            Set pptPres = pptApp.Presentations.Open(fullPath)
        End If
        
        ' 6. Navigate to Slide
        If Not pptPres Is Nothing Then
            If pptPres.SlideShowWindow Is Nothing Then
                pptPres.Slides(slideNum).Select
            Else
                pptPres.SlideShowWindow.View.GotoSlide slideNum
            End If
            
            ' 7. Bring to Front (The "Error 5" Fix)
            ' Instead of AppActivate, we use the WindowState command
            pptApp.Visible = True
            pptApp.WindowState = 3 ' 3 = ppWindowMaximized
            
            ' Try AppActivate only if it doesn't crash
            Err.Clear
            AppActivate pptApp.Caption
        End If
        On Error GoTo 0
    End If
End Sub
