Private Sub Worksheet_FollowHyperlink(ByVal Target As Hyperlink)
    ' This triggers when you click the cell (and gives you the "Hand" icon)
    If Not Intersect(Target.Range, Range("D3:D500")) Is Nothing Then
        LaunchPowerPoint Target.Range
    End If
End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
    ' Updates formatting when Column G (Slide #) or Column D (Link) changes
    Dim watchRange As Range
    Set watchRange = Range("D3:G500") 
    
    If Not Intersect(Target, watchRange) Is Nothing Then
        Application.EnableEvents = False
        RefreshLinkFormatting
        Application.EnableEvents = True
    End If
End Sub

Sub LaunchPowerPoint(ByVal Target As Range)
    Dim pptApp As Object, pptPres As Object
    Dim fullPath As String, fileName As String
    Dim slideNum As Long
    
    ' 1. Slide # is in Column G (3 columns to the right of D)
    If Target.Offset(0, 3).Value = "" Or Not IsNumeric(Target.Offset(0, 3).Value) Then
        MsgBox "No valid slide number found in Column G", vbExclamation
        Exit Sub
    End If
    
    slideNum = CLng(Target.Offset(0, 3).Value)
    fileName = "Charter Dev Form_v1.ppsx"
    fullPath = ThisWorkbook.Path & "\" & fileName ' Simplified: Same folder
    
    On Error Resume Next
    Set pptApp = GetObject(Class:="PowerPoint.Application")
    If pptApp Is Nothing Then
        Set pptApp = CreateObject(Class:="PowerPoint.Application")
        pptApp.Visible = True
    End If
    
    Set pptPres = pptApp.Presentations(fileName)
    If pptPres Is Nothing Then
        Set pptPres = pptApp.Presentations.Open(fullPath)
    End If
    On Error GoTo 0
    
    If Not pptPres Is Nothing Then
        ' Navigate to Slide
        If pptPres.SlideShowWindow Is Nothing Then
            pptPres.Slides(slideNum).Select
        Else
            pptPres.SlideShowWindow.View.GotoSlide slideNum
        End If
        
        pptApp.Visible = True
        pptApp.WindowState = 3 ' Maximized
        AppActivate "PowerPoint"
    Else
        MsgBox "Could not find the file: " & fileName, vbCritical
    End If
End Sub

Sub RefreshLinkFormatting()
    Dim cell As Range
    ' Scans Column D and adds/removes hyperlinks based on Column G
    For Each cell In Range("D3:D500")
        If cell.Offset(0, 3).Value <> "" And IsNumeric(cell.Offset(0, 3).Value) Then
            ' Add a dummy hyperlink to get the Hand Pointer
            ActiveSheet.Hyperlinks.Add Anchor:=cell, Address:="", SubAddress:=cell.Address
            With cell.Font
                .Color = RGB(0, 0, 255)
                .Underline = xlUnderlineStyleSingle
            End With
        Else
            ' Remove link and formatting if no slide number
            cell.Hyperlinks.Delete
            With cell.Font
                .ColorIndex = xlAutomatic
                .Underline = xlUnderlineStyleNone
            End With
        End If
    Next cell
End Sub
