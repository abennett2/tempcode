Private Sub Worksheet_SelectionChange(ByVal Target As Range)
    Dim pptApp As Object
    Dim pptPres As Object
    Dim fullPath As String
    Dim fileName As String
    Dim slideNum As Integer
    Dim folderPath As String

    ' 1. Only run if a SINGLE cell in your range is clicked
    If Not Intersect(Target, Range("D1:D500")) Is Nothing Then
        If Target.Cells.Count > 1 Then Exit Sub

        ' --- NEW SAFETY CHECK ---
        ' 2. Check if the cell to the right (Column E) is empty or not a number
        If Target.Offset(0, 1).Value = "" Or Not IsNumeric(Target.Offset(0, 1).Value) Then
            Exit Sub ' Do nothing and let the user select the cell normally
        End If
        
        ' 3. Get the slide number now that we know it's valid
        slideNum = Val(Target.Offset(0, 1).Value)

        ' 4. SHAREPOINT PATH LOGIC
        folderPath = Left(ThisWorkbook.Path, InStrRev(ThisWorkbook.Path, "/") - 1)
        fileName = "Charter Dev Form_v1.ppsx"
        fullPath = folderPath & "/" & fileName

        On Error Resume Next
        ' 5. Connect to PowerPoint
        Set pptApp = GetObject(Class:="PowerPoint.Application")
        If pptApp Is Nothing Then
            Set pptApp = CreateObject(Class:="PowerPoint.Application")
            pptApp.Visible = True
        End If
        
        ' 6. Open/Find the presentation
        Set pptPres = pptApp.Presentations(fileName)
        If pptPres Is Nothing Then
            Set pptPres = pptApp.Presentations.Open(fullPath)
        End If
        
        ' 7. Navigate to Slide
        If Not pptPres Is Nothing Then
            If pptPres.SlideShowWindow Is Nothing Then
                pptPres.Slides(slideNum).Select
            Else
                pptPres.SlideShowWindow.View.GotoSlide slideNum
            End If
            
            pptApp.Visible = True
            pptApp.WindowState = 3 
            AppActivate "PowerPoint"
        End If
        
        ' 8. UI POLISH: Move selection off the cell so it can be clicked again
        ' We move to the slide number cell itself
        Target.Offset(0, 1).Select 
        
        On Error GoTo 0
    End If
End Sub
